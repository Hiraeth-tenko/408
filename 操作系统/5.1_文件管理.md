---
aliases:
tags:
  - 操作系统
date created: 2023-10-09 一 09:05:44
date modified: 2023-10-14 六 01:18:33
---

# Link

---

Previous: [4.1\_内存管理基本原理](4.1_内存管理基本原理.md)

Next: [5.2\_目录](5.2_目录.md)

# 文件管理

---

## 文件控制块

文件控制块，存放了用于控制文件需要的各种文件描述信息的数据结构，以实现按名存取。

## 索引结点

在按名存取时，只需要文件的名字就可以识别是否为需要的文件。因此引入一种方法，将文件名与文件描述信息分开存放，文件描述信息组织成一个被称为索引结点的数据结构，简称 i 结点。内存中文件目录的目录项由文件名和指向 i 结点的指针组成，

### 磁盘索引结点

存放在磁盘的索引节点，每个文件由有一个唯一的磁盘索引结点。

包含以下内容：

- 文件主标识符
- 文件类型
- 文件存取权限
- 文件物理地址
- 文件长度
- 文件连接计数
- 文件存取时间

### 内存索引结点

存放在内存的索引结点，文件被打开时需要将磁盘索引结点复制到内存索引结点。

新增以下内容：

- 索引结点编号
- 状态
- 访问计数
- 逻辑设备号
- 链接指针

## 文件操作

### 创建文件

为新文件分配必要的外存空间，在目录中创建一个目录项，目录项记录了新文件名、在外存中的地址及其他可能的信息。

### 写文件

为了写文件，执行一个系统调用。对于给定文件名，搜索目录以查找文件位置。系统必须为该文件维护一个写位置的指针。每当发生写操作时，便更新写指针。

### 读文件

为了读文件，执行一个系统调用。同样需要搜索目录以找到相关目录项，系统维护一个读位置的指针。每当发生读操作时，更新读指针。一个进程通常只对一个文件
读或写，因此当前操作位置可作为每个进程当前文件位置的指针。由于读和写操作都使用同一个指针，因此节省了空间，也降低了系统复杂度。

### 重新定位文件

搜索目录以找到适当的条目，并将当前文件位置指针重新定位到给定值。重新定位文件不涉及读、写文件。

### 删除文件

先从目录中检索指定文件名的目录项，然后释放该文件所占的存储空间，以便可被其他文件重复使用，并删除目录条目。

### 截断文件

允许文件所有属性不变，并删除文件内容，将其长度置为 0 并释放其空间。

### 打开与关闭文件

操作系统维护一个打开文件表，表包含了所有被打开文件的文件信息。文件被打开的时候，就从外存将文件复制到内存中打开文件表的一个条目中。当文件不再使用是就删除该条目。

采用两级表的操作系统维护两个打开文件表：整个系统的打开文件表和每个进程的打开文件表。

文件被打开时，复制到系统打开文件表，进程打开文件表中的条目指向系统打开文件表里对应条目。系统打开文件表为每个文件设置一个计数器，每有一个进程打开文件表关联到这个文件时计数器加 1，反之减 1；计数器为 0 时删除这个条目。

文件打开后，就不再需要文件名，而是通过文件描述符或文件句柄来标识。

打开文件有以下关联信息：

- 文件指针
- 文件打开技术
- 文件磁盘位置
- 访问权限

## 文件保护

文件保护主要针对以下操作：

- 读写
- 执行
- 添加
- 删除
- 列出

### 访问控制

#### 基于身份的访问控制

为文件和目录增加一个访问控制表。

访问控制表采用拥有者、组、其他三种身份进行访问控制。

#### 口令

#### 密码

## 文件结构

### 物理结构

#### 连续分配

每个文件在磁盘上占用连续的空间。使用连续分配时，目录项的文件物理地址包括：起始地址和文件分配区域长度。

#### 隐式链接分配

目录项中含有文件地址的第一块磁盘块和最后一块的地址。每个磁盘块都含有指向下一块磁盘块的地址。

通过将多个磁盘块组成簇，按簇分配可以减少查找时间，但是增加了内部碎片。

#### 显示链接分配

在内存中，对每个磁盘中设置一张文件分配表（FAT），存放链接文件各物理块的指针。

FAT 的每个表项存放下一块的盘块号。使用特殊数字-1 标识是文件的最后一块；使用-2 标识是空闲块……

在目录项中文件物理地址包含：起始块号

#### 索引分配

将每个文件的所有盘块号集合成一个索引块，对于大文件可能需要多个索引块。则索引块内部条目均直接指向文件的某个块，或下一级索引块。

#### 混合索引分配

设置多级索引，如直接块，一级间址，二级间址，三级间址的形式。

UNINX 设置了 10 块直接块、1 块一级间址、1 块二级间址、1 块三级间址。

直接块直接指向文件数据盘块，假设每块大小 4KB，那么不大于 40KB 的文件可以直接得到全部盘块号。

一级间址指向另一个索引块，假设索引条目大小 4B，那么一块索引块可以存放 1K 条索引项目，最大可以支持 $4KB \times 1K + 40KB$ 大小的文件。

### 逻辑结构

#### 无结构文件

以字节为单位。源程序文件、目标代码文件都属于无结构文件。

#### 有结构文件

##### 顺序文件

顺序文件中的记录通常是定长的。

- 串结构：记录之间的顺序与关键字无关，检索从头开始。
- 顺序结构：按关键字排序。

适用于批量操作的场合，磁带就是一种顺序存储设备。

##### 索引文件

- 定长记录：可以进行随机检索。
- 变长记录：无索引表的变长记录文件只能顺序查找；建立索引表的变长记录文件可以进行随机检索。

##### 顺序索引文件

将顺序文件分组，再根据分组的键建立索引表。通过索引到组再进行顺序查找，类似组相联映射。

##### 直接文件

通过散列函数直接计算地址。

## 目录

[5.2\_目录](5.2_目录.md)

## 文件系统

[5.3\_文件系统](5.3_文件系统.md)

# Relative

---

[0\_操作系统思维导图](0_操作系统思维导图.md)

# Reference

---
