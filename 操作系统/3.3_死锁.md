---
aliases:
tags:
  - 操作系统
date created: 2023-10-08 日 06:49:21
date modified: 2023-10-09 一 10:00:48
---

# Link

---

Previous: [3.2.1\_同步与互斥](3.2.1_同步与互斥.md)

Next: [4.1\_内存管理基本原理](4.1_内存管理基本原理.md)

# 死锁

---

## 死锁的条件

- 互斥条件
- 不剥夺条件
- 请求并保持条件
- 循环等待条件

同时满足上述四个条件时，系统进入死锁。

## 预防死锁

破坏四个死锁条件之一即可。

预防死锁是**确保系统不发生死锁**。

### 破坏互斥条件

使得所有资源都共享。

### 破坏不剥夺条件

已持有资源的进程在请求新的资源时无法得到满足时，放弃原先持有的资源。

由于剥夺进程资源会导致之前作业的进度失效，所以仅适用于可以保存并恢复现场的资源（如 CPU 寄存器、内存）。

### 破坏请求并保持条件

采用预先静态分配，在进程开始时一次性分配所需资源，不满足所需资源的进程不开始。

### 破坏循环等待条件

采用顺序资源分配法。

## 避免死锁

避免死锁是**避免系统进入死锁状态**。

### 系统安全状态

所谓安全状态，是指系统能按某种进程推进顺序 $(P_1,P_2,\cdot\cdot\cdot ,P_n)$ 为每个进程 $P_i$ 分配其所需的资源，直至满足每个进程对资源的最大需求，使每个进程都可顺序完成。此时称 $(P_1,P_2,\cdot\cdot\cdot ,P_n)$ 为安全序列。若系统无法找到一个安全序列，则称系统处于不安全状态。

### 银行家算法思想

1. 系统在启动时需要知道每类资源的总数以及可用资源的数量。这些信息通常由系统管理员提前配置。

2. 当一个进程请求资源时，系统会先检查分配给该进程的资源是否超出了它的最大需求（最大资源需求），如果超出则请求无法满足。

3. 如果请求的资源不会导致系统进入不安全状态（即不会引发死锁），则系统会分配资源给进程，同时减少可用资源数量。

4. 进程执行完毕后会释放已分配的资源，增加可用资源的数量。

5. 当进程释放资源时，系统检查是否有其他进程等待这些资源，如果有，则系统分配这些资源给等待的进程。

根据如上思想，做题时只需要将每个可能的分配序列考虑一遍，同时注意资源分配的减少与资源回收的增加即可解决银行家算法问题与预防死锁问题。

## 检测死锁

检测死锁是检测系统是否存在死锁，若存在则通过死锁解除方法**解除死锁**。

### 资源分配图

资源分配图通常由以下几个元素组成：

1. **进程（进程节点）**：圆圈表示系统中的进程。每个进程需要一定数量的资源来完成其任务。
2. **资源（资源节点）**：矩形表示可用的资源，如打印机、内存块等。每个资源内部的圆圈一定数量的实例。
3. **分配边（Allocation Edge）**：资源到进程的箭头 $资源\rightarrow 进程$ 表示资源已经被分配给了该进程。每条箭头表示占用一个资源。
4. **请求边（Request Edge）**：进程到资源的箭头 $进程\rightarrow 资源$ 表示进程请求该资源。每条箭头表示请求一个资源。

### 死锁定理

通过简化资源分配图来检测系统是否处于死锁状态。如果系统可以通过简化资源分配图消去所有的请求边与分配边，那么该系统不处于死锁状态。

1. 找出申请资源数量小于等于系统空闲资源的进程。消除该进程的请求边与分配边。申请资源小于空闲资源数量，说明该进程可以运行直到完成。则释放该进程占有的资源。

2. 重复上述操作直到不能继续消除边为止。若此时系统分配图中仍有请求边与分配边，说明系统存在死锁。

### 死锁解除

- 资源剥夺法
- 撤销进程法
- 进程回退法

# Relative

---

[3.2.1\_同步与互斥](3.2.1_同步与互斥.md)

# Reference

---
