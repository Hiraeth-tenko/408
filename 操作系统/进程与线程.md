---
aliases: []
tags:
  - 计算机组成原理
date created: 2023-09-09 六 05:02:28
date modified: 2023-09-09 六 06:07:02
---

# Link

---

Previous: [操作系统运行环境](操作系统运行环境.md)

Next:[处理机调度](处理机调度.md)

# 进程与线程

---

## 进程的组成

进程控制块、程序段、数据段构成一个进程实体，又称进程映像。

### 进程控制块（**PCB**）

进程创建时，OS 为它新建一个 PCB，常驻与内存直到进程结束被释放。

OS 通过 PCB 对进程进行控制管理。

### 程序段

### 数据段

## 进程管理与控制

### 创建

#### 引起进程创建的事件

- 用户登录 OS
- 作业调度时需要创建进程
- 系统服务
- 用户程序的应用请求

#### 创建原语

- 为新进程分配一个唯一的进程号（PID），并申请一个空白 PCB。PCB 申请失败则进程创建失败。
- 为进程分配资源。资源不足以新建进程时，该进程处于**创建态**。
- 初始化 PCB。
- 若就绪队列有空则进入**就绪态**等待调度。否则进入**阻塞态**。

### 阻塞

阻塞是进程自身主动的行为。

#### 导致进程阻塞的事件

- 请求资源失败
- 等待操作完成
- 新数据未到达

#### 阻塞原语

- 根据 PID 找到将要被阻塞进程对应的 PCB。
- 若该进程处于**运行态**，保护其现场，将状态转移到**阻塞态**，暂停运行。
- 将 PCB 转移到相应事件的等待队列，处理器资源被调度给其他**就绪态**进程。

### 唤醒

#### 引起进程唤醒的事件

- 期待的数据到达
- 某种操作完成

#### 唤醒原语

- 在相应事件的等待队列中找到对应的 PCB。
- 从等待队列中移除，将状态由**阻塞态**转移到**就绪态**。
- 加入到就绪队列。

### 终止

#### 引起进程终止的事件

- 正常结束
- 异常结束，发生错误或故障等
- 来自外界的指令

#### 终止原语

- 根据 PID 找到对应的 PCB，获取进程的状态。
- 若进程处于**运行态**，则终止运行，将处理器资源调度给其他进程。
- 如果有子孙进程，终止所有的子孙进程。
- 释放拥有的资源，归还父进程或 OS。
- 将 PCB 删除。

### 父进程与子进程

父进程可以创建子进程，子进程的资源由父进程中分配；子进程结束时归还资源给父进程；父进程结束时，结束其所有的子进程。

## 进程的状态与转换

- 创建态 -> 就绪态
- 就绪态 -> 阻塞态
- 就绪态 -> 运行态
  根据程序调度，就绪态的进行获取到处理器资源时，由就绪态转移到运行态。
- 运行态 -> 就绪态
  当运行态的进程用完其时间片，由运行态转移到就绪态。
- 运行态 -> 阻塞态
  运行态的进程需要等待事件发生时，转移到阻塞态
- 运行态 -> 终止态
- 阻塞态 -> 就绪态
  阻塞态进程等待的事件发生后，转移到就绪态

|      | 唤醒                 | 阻塞              | 就绪             |
| ---- | -------------------- | ----------------- | ---------------- |
| 事件 | I/O 结束             | 申请外设          | 高优先级任务抢占 |
|      | 其他进程释放临界资源 | 申请 I/O          | 时间片用完       |
|      |                      | 执行 P (wait)操作 |                  |
|      |                      | 申请临界资源      |                  |

## 进程的通信

### 共享存储

通信的进程之间存在一块可以直接访问的共享内存空间，通过系统调用实现。在读写操作的时候，需要使用同步互斥工具。

### 消息传递

OS 提供一种消息传递方式实现进程通信。

#### 直接通信

发送进程把消息发送给接收进程，接收进程把消息挂在其消息缓冲队列中，并从中取得消息。

#### 间接通信

发送进程把消息发到某个中间实体（信箱），接收进程从中间实体获取消息。

#### 管道通信

通过管道通信，两个进程按照生产者-消费者方式进行通信。

- 管道只允许单向通信
  需要双向通信需要两个管道
- 读写进程可以并行；读速度大于写速度时，读进程阻塞；反之写进程阻塞。

## 线程的概念

线程是一种轻量的进程。

线程不占有系统资源，它共享它所属的进程全部资源。

## 线程的控制与管理

线程同样具有控制块，称为线程控制块。

线程控制块的内容是该线程独占的，包括：

- 线程标识符
- 寄存器
- 运行状态
- 优先级
- 专属存储区
- 堆栈指针

## 线程的状态与转换

## 用户级与内核级线程

## 多线程

多线程有三种模型

### 多对一

多个用户级线程映射到一个内核级线程。调度管理在用户态，需要访问内核时映射到内核级线程。一次只能映射一个用户级线程。

### 一对一

每个用户级线程映射一个内核级线程。

### 多对多

将 n 个用户级线程映射到 m 个内核级线程，其中 $n\ge m$

# Relative

---

[操作系统思维导图](操作系统思维导图.md)

# Reference

---
